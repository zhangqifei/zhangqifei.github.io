{"title":"CentOS7启动及排错","slug":"centos7/CentOS7启动及排错","date":"2017-01-06T17:50:32.000Z","updated":"2019-05-22T08:57:02.380Z","comments":true,"path":"api/articles/centos7/CentOS7启动及排错.json","excerpt":null,"covers":null,"content":"<h1 id=\"CentOS7引导顺序\"><a href=\"#CentOS7引导顺序\" class=\"headerlink\" title=\"CentOS7引导顺序\"></a>CentOS7引导顺序</h1><ul>\n<li>UEFi或BIOS初始化，运行POST开机自检</li>\n<li>选择启动设备</li>\n<li>引导装载程序, centos7是grub2</li>\n<li>加载装载程序的配置文件：<br>/etc/grub.d/<br>/etc/default/grub<br>/boot/grub2/grub.cfg</li>\n<li>加载initramfs驱动模块加载内核选项</li>\n<li>内核初始化，centos7使用systemd代替init </li>\n<li>执行initrd.target所有单元，包括挂载/etc/fstab</li>\n<li>从initramfs根文件系统切换到磁盘根目录</li>\n<li>systemd执行默认target配置，配置文件/etc/systemd/system/default.target</li>\n<li>systemd执行sysinit.target初始化系统及basic.target准备操作系统</li>\n<li>systemd启动multi-user.target下的本机与服务器服务</li>\n<li>systemd执行multi-user.target下的/etc/rc.d/rc.local</li>\n<li>Systemd执行multi-user.target下的getty.target及登录服务</li>\n<li>systemd执行graphical需要的服务</li>\n</ul>\n<h2 id=\"设置内核参数\"><a href=\"#设置内核参数\" class=\"headerlink\" title=\"设置内核参数\"></a>设置内核参数</h2><ul>\n<li>设置内核参数，只影响当次启动</li>\n<li>启动时，在linux16行后添加systemd.unit=desired.target</li>\n<li>systemd.unit=emergency.target </li>\n<li>systemd.unit=rescue.target</li>\n<li>rescue.target 比emergency 支持更多的功能，例如日志等</li>\n<li>systemctl  default  进入默认target</li>\n</ul>\n<h2 id=\"启动排错\"><a href=\"#启动排错\" class=\"headerlink\" title=\"启动排错\"></a>启动排错</h2><ul>\n<li>文件系统损坏<br>先尝试自动修复，失败则进入emergency shell，提示用户修复</li>\n<li>在/etc/fstab不存在对应的设备和UUID<br>等一段时间，如不可用，进入emergency shell</li>\n<li>在/etc/fstab不存在对应挂载点<br>systemd尝试创建挂载点，否则提示进入emergency shell.</li>\n<li>在/etc/fstab不正确的挂载选项<br>提示进入emergency shell</li>\n</ul>\n<h2 id=\"破解CentOS7的root口令方法一\"><a href=\"#破解CentOS7的root口令方法一\" class=\"headerlink\" title=\"破解CentOS7的root口令方法一\"></a>破解CentOS7的root口令方法一</h2><ul>\n<li>启动时任意键暂停启动</li>\n<li>按e键进入编辑模式</li>\n<li>将光标移动linux16开始的行，添加内核参数rd.break</li>\n<li>按ctrl-x启动</li>\n<li>mount –o remount,rw  /sysroot</li>\n<li>chroot /sysroot</li>\n<li>passwd root</li>\n<li>touch /.autorelabel</li>\n<li>exit</li>\n<li>reboot破解</li>\n</ul>\n<h2 id=\"破解CentOS7的root口令方法二\"><a href=\"#破解CentOS7的root口令方法二\" class=\"headerlink\" title=\"破解CentOS7的root口令方法二\"></a>破解CentOS7的root口令方法二</h2><ul>\n<li>启动时任意键暂停启动</li>\n<li>按e键进入编辑模式</li>\n<li>将光标移动linux16开始的行，改为rw init=/sysroot/bin/sh</li>\n<li>按ctrl-x启动</li>\n<li>chroot /sysroot</li>\n<li>passwd root</li>\n<li>touch /.autorelabel</li>\n<li>exit</li>\n<li>reboot</li>\n</ul>\n<h2 id=\"centous7设置默认启动内核，并删除\"><a href=\"#centous7设置默认启动内核，并删除\" class=\"headerlink\" title=\"centous7设置默认启动内核，并删除\"></a>centous7设置默认启动内核，并删除</h2><p>配置文件 ：/boot/grub2/grub.cfg<br>修改：/etc/default/grub  GRUB_DEFAULT=saved saved改为0<br>grub2-mkconfig -o /boot/grub2/grub.crg 重新生成</p>\n<p>删除没用的内核<br>/boot/ 和 /lib/modules/ 里面内核版本的东西 3.10.0.xxxx<br>grub2-mkconfig -o /boot/grub2/grub.crg 重新生成</p>\n<h2 id=\"修复GRUB2\"><a href=\"#修复GRUB2\" class=\"headerlink\" title=\"修复GRUB2\"></a>修复GRUB2</h2><ul>\n<li>GRUB”the Grand Unified Bootloader”引导提示时可以使用命令行界面可从文件系统引导</li>\n<li>主要配置文件/boot/grub2/grub.cfg</li>\n<li>修复配置文件grub2-mkconfig &gt; /boot/grub2/grub.cfg</li>\n<li>修复grub grub2-install /dev/sdaBIOS环境grub2-install  UEFI环境</li>\n<li>调整默认启动内核vim /etc/default/grubGRUB_DEFAULT=0</li>\n</ul>\n<center>![grub.cfg破坏][1]</center>\n\n<h2 id=\"删除boot下所有\"><a href=\"#删除boot下所有\" class=\"headerlink\" title=\"删除boot下所有\"></a>删除boot下所有</h2><ol>\n<li>进入救援模式</li>\n<li>输入 1 continue</li>\n<li>2 进入shell</li>\n<li>chroot /mnt/sysimage  </li>\n<li>mkdir /mnt/cdroom</li>\n<li>mount -o /dev/cdroom /mnt/cdroom</li>\n<li>rpm -ivh /mnt/cdroom/Packages/kernel-3.10.0.693.e17.x86.rpm –force </li>\n<li>grub2-install /dev/sda</li>\n<li>修复配置文件grub2-mkconfig &gt; /boot/grub2/grub.cfg</li>\n<li>exit</li>\n<li>reboot</li>\n</ol>\n","more":"<h1 id=\"CentOS7引导顺序\"><a href=\"#CentOS7引导顺序\" class=\"headerlink\" title=\"CentOS7引导顺序\"></a>CentOS7引导顺序</h1><ul>\n<li>UEFi或BIOS初始化，运行POST开机自检</li>\n<li>选择启动设备</li>\n<li>引导装载程序, centos7是grub2</li>\n<li>加载装载程序的配置文件：<br>/etc/grub.d/<br>/etc/default/grub<br>/boot/grub2/grub.cfg</li>\n<li>加载initramfs驱动模块加载内核选项</li>\n<li>内核初始化，centos7使用systemd代替init </li>\n<li>执行initrd.target所有单元，包括挂载/etc/fstab</li>\n<li>从initramfs根文件系统切换到磁盘根目录</li>\n<li>systemd执行默认target配置，配置文件/etc/systemd/system/default.target</li>\n<li>systemd执行sysinit.target初始化系统及basic.target准备操作系统</li>\n<li>systemd启动multi-user.target下的本机与服务器服务</li>\n<li>systemd执行multi-user.target下的/etc/rc.d/rc.local</li>\n<li>Systemd执行multi-user.target下的getty.target及登录服务</li>\n<li>systemd执行graphical需要的服务</li>\n</ul>\n<h2 id=\"设置内核参数\"><a href=\"#设置内核参数\" class=\"headerlink\" title=\"设置内核参数\"></a>设置内核参数</h2><ul>\n<li>设置内核参数，只影响当次启动</li>\n<li>启动时，在linux16行后添加systemd.unit=desired.target</li>\n<li>systemd.unit=emergency.target </li>\n<li>systemd.unit=rescue.target</li>\n<li>rescue.target 比emergency 支持更多的功能，例如日志等</li>\n<li>systemctl  default  进入默认target</li>\n</ul>\n<h2 id=\"启动排错\"><a href=\"#启动排错\" class=\"headerlink\" title=\"启动排错\"></a>启动排错</h2><ul>\n<li>文件系统损坏<br>先尝试自动修复，失败则进入emergency shell，提示用户修复</li>\n<li>在/etc/fstab不存在对应的设备和UUID<br>等一段时间，如不可用，进入emergency shell</li>\n<li>在/etc/fstab不存在对应挂载点<br>systemd尝试创建挂载点，否则提示进入emergency shell.</li>\n<li>在/etc/fstab不正确的挂载选项<br>提示进入emergency shell</li>\n</ul>\n<h2 id=\"破解CentOS7的root口令方法一\"><a href=\"#破解CentOS7的root口令方法一\" class=\"headerlink\" title=\"破解CentOS7的root口令方法一\"></a>破解CentOS7的root口令方法一</h2><ul>\n<li>启动时任意键暂停启动</li>\n<li>按e键进入编辑模式</li>\n<li>将光标移动linux16开始的行，添加内核参数rd.break</li>\n<li>按ctrl-x启动</li>\n<li>mount –o remount,rw  /sysroot</li>\n<li>chroot /sysroot</li>\n<li>passwd root</li>\n<li>touch /.autorelabel</li>\n<li>exit</li>\n<li>reboot破解</li>\n</ul>\n<h2 id=\"破解CentOS7的root口令方法二\"><a href=\"#破解CentOS7的root口令方法二\" class=\"headerlink\" title=\"破解CentOS7的root口令方法二\"></a>破解CentOS7的root口令方法二</h2><ul>\n<li>启动时任意键暂停启动</li>\n<li>按e键进入编辑模式</li>\n<li>将光标移动linux16开始的行，改为rw init=/sysroot/bin/sh</li>\n<li>按ctrl-x启动</li>\n<li>chroot /sysroot</li>\n<li>passwd root</li>\n<li>touch /.autorelabel</li>\n<li>exit</li>\n<li>reboot</li>\n</ul>\n<h2 id=\"centous7设置默认启动内核，并删除\"><a href=\"#centous7设置默认启动内核，并删除\" class=\"headerlink\" title=\"centous7设置默认启动内核，并删除\"></a>centous7设置默认启动内核，并删除</h2><p>配置文件 ：/boot/grub2/grub.cfg<br>修改：/etc/default/grub  GRUB_DEFAULT=saved saved改为0<br>grub2-mkconfig -o /boot/grub2/grub.crg 重新生成</p>\n<p>删除没用的内核<br>/boot/ 和 /lib/modules/ 里面内核版本的东西 3.10.0.xxxx<br>grub2-mkconfig -o /boot/grub2/grub.crg 重新生成</p>\n<h2 id=\"修复GRUB2\"><a href=\"#修复GRUB2\" class=\"headerlink\" title=\"修复GRUB2\"></a>修复GRUB2</h2><ul>\n<li>GRUB”the Grand Unified Bootloader”引导提示时可以使用命令行界面可从文件系统引导</li>\n<li>主要配置文件/boot/grub2/grub.cfg</li>\n<li>修复配置文件grub2-mkconfig &gt; /boot/grub2/grub.cfg</li>\n<li>修复grub grub2-install /dev/sdaBIOS环境grub2-install  UEFI环境</li>\n<li>调整默认启动内核vim /etc/default/grubGRUB_DEFAULT=0</li>\n</ul>\n<center>![grub.cfg破坏][1]</center>\n\n<h2 id=\"删除boot下所有\"><a href=\"#删除boot下所有\" class=\"headerlink\" title=\"删除boot下所有\"></a>删除boot下所有</h2><ol>\n<li>进入救援模式</li>\n<li>输入 1 continue</li>\n<li>2 进入shell</li>\n<li>chroot /mnt/sysimage  </li>\n<li>mkdir /mnt/cdroom</li>\n<li>mount -o /dev/cdroom /mnt/cdroom</li>\n<li>rpm -ivh /mnt/cdroom/Packages/kernel-3.10.0.693.e17.x86.rpm –force </li>\n<li>grub2-install /dev/sda</li>\n<li>修复配置文件grub2-mkconfig &gt; /boot/grub2/grub.cfg</li>\n<li>exit</li>\n<li>reboot</li>\n</ol>\n","categories":[{"name":"centos7","path":"api/categories/centos7.json"}],"tags":[{"name":"centos7","path":"api/tags/centos7.json"}]}