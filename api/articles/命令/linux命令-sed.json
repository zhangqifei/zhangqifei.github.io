{"title":"linux命令-sed","slug":"命令/linux命令-sed","date":"2019-05-22T09:25:24.606Z","updated":"2019-05-22T09:25:24.611Z","comments":true,"path":"api/articles/命令/linux命令-sed.json","excerpt":null,"covers":null,"content":"<p>sed流编辑器（stream editor） <a href=\"http://www.gnu.org/software/sed/manual/sed.html\" target=\"_blank\" rel=\"noopener\">sed手册</a></p>\n<blockquote>\n<p>处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed 选项 '子命令' 文件名</span><br><span class=\"line\">sed 选项 -e '子命令1' -e '子命令2' 文件名</span><br><span class=\"line\">sed -f 脚本文件 文件名</span><br><span class=\"line\">sed -f 脚本1 -f 脚本2 文件名</span><br></pre></td></tr></table></figure>\n<ul>\n<li>可以指定多个 <code>-e</code> 和 <code>-f</code></li>\n<li>sed 中变量使用单引号包含双引号方式： <code>&#39;&quot;$var&quot;&#39;</code></li>\n</ul>\n<h1 id=\"选项\"><a href=\"#选项\" class=\"headerlink\" title=\"选项\"></a>选项</h1><ul>\n<li><code>-e</code>或<code>--expression=命令</code>  指定用以处理文件的脚本内容</li>\n<li><code>-f</code>或<code>--file=脚本文件</code>  指定用以处理文件的脚本文件</li>\n</ul>\n<ul>\n<li><code>-i</code>或<code>--in-place[=SUFFIX]</code> 编辑文件内容并取代原文件</li>\n<li><code>-n</code>或<code>--quiet</code>或<code>--silent</code> 安静模式 仅显示处理后的结果</li>\n<li><code>-l</code>或<code>--line-length=N</code>   指定换行期望长度</li>\n<li><code>-r</code>或<code>-regexp-extended</code>  启用扩展的正则表达式</li>\n<li><code>-u</code>或<code>–unbuffered</code>  从输入文件中加载最少的数据，并更频繁的刷出到输出缓冲区</li>\n<li><code>-z</code>或<code>–null-data</code>  使用NULL字符分割行（默认每一行使用换行符分割）</li>\n</ul>\n<h1 id=\"子命令\"><a href=\"#子命令\" class=\"headerlink\" title=\"子命令\"></a>子命令</h1><p>多个子命令间使用<code>;</code>分隔。</p>\n<h2 id=\"行定位\"><a href=\"#行定位\" class=\"headerlink\" title=\"行定位\"></a>行定位</h2><p>在行定位命令后紧邻写上各种操作命令</p>\n<h3 id=\"单行\"><a href=\"#单行\" class=\"headerlink\" title=\"单行\"></a>单行</h3><ul>\n<li>数字n：第n行</li>\n<li><code>$</code>：最后一行</li>\n<li>正则<code>/pattern/</code>： 匹配该正则的那行</li>\n</ul>\n<h3 id=\"多行\"><a href=\"#多行\" class=\"headerlink\" title=\"多行\"></a>多行</h3><ul>\n<li><p>数字<code>m,n</code>：  第m到n行</p>\n</li>\n<li><p>数字和正则混合<code>/pattern/,n</code>和<code>n,/pattern/</code></p>\n</li>\n<li><p>两个正则之间的行：/pattern1/,/pattern2/</p>\n</li>\n<li><p><code>n!</code>  取反：除了第n行  m,n!</p>\n</li>\n<li><p><code>n~x</code>：从第n行开始处理，下一次处理当前行后面的x行</p>\n<p>例如<code>1~2</code>表示从第1行开始处理，下一次处理当前行后面的第2行，也就是依次处理1，3，5，7……行</p>\n</li>\n</ul>\n<h2 id=\"打印-p\"><a href=\"#打印-p\" class=\"headerlink\" title=\"打印 p\"></a>打印 p</h2><p>将模式空间写到标准输出。注意：使用<code>sed &#39;p&#39; filename</code>会将文件内容每行打印两次，配合<code>-n</code>（或<code>--quiet</code>或<code>--silent</code>） 则可只打印一次（仅显示处理后的结果）。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed  --quiet '2,10p' file  #打印第2到10行</span><br><span class=\"line\">sed --quiet ''</span><br></pre></td></tr></table></figure>\n<h2 id=\"替换-s\"><a href=\"#替换-s\" class=\"headerlink\" title=\"替换 s\"></a>替换 s</h2><p>命令格式： <code>s/原内容/新内容/</code></p>\n<ul>\n<li>g全局替换：<code>s/原内容/新内容/g</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip addr | grep -o -E '1[^2][0-9?](\\.[0-9]&#123;1,3&#125;)&#123;3&#125;\\/' -o | sed 's/\\///'  #本机ip</span><br></pre></td></tr></table></figure>\n<h2 id=\"行编辑\"><a href=\"#行编辑\" class=\"headerlink\" title=\"行编辑\"></a>行编辑</h2><ul>\n<li>新增行<ul>\n<li><code>a</code>  在匹配项的<strong>下一行</strong>新增内容</li>\n<li><code>i</code>   在匹配项的<strong>上一行</strong>新增内容</li>\n</ul>\n</li>\n<li>替换行  <code>c</code></li>\n<li>删除行  <code>d</code></li>\n<li>多行<ul>\n<li>N  将数据流中的下一行加进来创建一个多行组来处理</li>\n<li>D  删除多行组中的一行</li>\n<li>P  打印多行组中的一行</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed  -i -e '1a hello' -e '2i world' filename</span><br><span class=\"line\">sed -i -e '1d' -e '2c new-world' filename</span><br></pre></td></tr></table></figure>\n<h2 id=\"模式空间\"><a href=\"#模式空间\" class=\"headerlink\" title=\"模式空间\"></a>模式空间</h2><p>  把当前处理的行存储在临时缓冲区中——模式空间。</p>\n<ul>\n<li><code>N</code>  将下一行内容纳入当前缓冲区</li>\n</ul>\n<ul>\n<li><code>h</code>  将模式空间复制到保持空间</li>\n<li><code>H</code>  将模式空间附加到保持空间</li>\n<li><code>g</code>  将保持空间复制到模式空间</li>\n<li><code>G</code>  将保持空间附加到模式空间</li>\n<li><code>x</code>  交换模式空间和保持空间的内容</li>\n</ul>\n","more":"<p>sed流编辑器（stream editor） <a href=\"http://www.gnu.org/software/sed/manual/sed.html\" target=\"_blank\" rel=\"noopener\">sed手册</a></p>\n<blockquote>\n<p>处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed 选项 '子命令' 文件名</span><br><span class=\"line\">sed 选项 -e '子命令1' -e '子命令2' 文件名</span><br><span class=\"line\">sed -f 脚本文件 文件名</span><br><span class=\"line\">sed -f 脚本1 -f 脚本2 文件名</span><br></pre></td></tr></table></figure>\n<ul>\n<li>可以指定多个 <code>-e</code> 和 <code>-f</code></li>\n<li>sed 中变量使用单引号包含双引号方式： <code>&#39;&quot;$var&quot;&#39;</code></li>\n</ul>\n<h1 id=\"选项\"><a href=\"#选项\" class=\"headerlink\" title=\"选项\"></a>选项</h1><ul>\n<li><code>-e</code>或<code>--expression=命令</code>  指定用以处理文件的脚本内容</li>\n<li><code>-f</code>或<code>--file=脚本文件</code>  指定用以处理文件的脚本文件</li>\n</ul>\n<ul>\n<li><code>-i</code>或<code>--in-place[=SUFFIX]</code> 编辑文件内容并取代原文件</li>\n<li><code>-n</code>或<code>--quiet</code>或<code>--silent</code> 安静模式 仅显示处理后的结果</li>\n<li><code>-l</code>或<code>--line-length=N</code>   指定换行期望长度</li>\n<li><code>-r</code>或<code>-regexp-extended</code>  启用扩展的正则表达式</li>\n<li><code>-u</code>或<code>–unbuffered</code>  从输入文件中加载最少的数据，并更频繁的刷出到输出缓冲区</li>\n<li><code>-z</code>或<code>–null-data</code>  使用NULL字符分割行（默认每一行使用换行符分割）</li>\n</ul>\n<h1 id=\"子命令\"><a href=\"#子命令\" class=\"headerlink\" title=\"子命令\"></a>子命令</h1><p>多个子命令间使用<code>;</code>分隔。</p>\n<h2 id=\"行定位\"><a href=\"#行定位\" class=\"headerlink\" title=\"行定位\"></a>行定位</h2><p>在行定位命令后紧邻写上各种操作命令</p>\n<h3 id=\"单行\"><a href=\"#单行\" class=\"headerlink\" title=\"单行\"></a>单行</h3><ul>\n<li>数字n：第n行</li>\n<li><code>$</code>：最后一行</li>\n<li>正则<code>/pattern/</code>： 匹配该正则的那行</li>\n</ul>\n<h3 id=\"多行\"><a href=\"#多行\" class=\"headerlink\" title=\"多行\"></a>多行</h3><ul>\n<li><p>数字<code>m,n</code>：  第m到n行</p>\n</li>\n<li><p>数字和正则混合<code>/pattern/,n</code>和<code>n,/pattern/</code></p>\n</li>\n<li><p>两个正则之间的行：/pattern1/,/pattern2/</p>\n</li>\n<li><p><code>n!</code>  取反：除了第n行  m,n!</p>\n</li>\n<li><p><code>n~x</code>：从第n行开始处理，下一次处理当前行后面的x行</p>\n<p>例如<code>1~2</code>表示从第1行开始处理，下一次处理当前行后面的第2行，也就是依次处理1，3，5，7……行</p>\n</li>\n</ul>\n<h2 id=\"打印-p\"><a href=\"#打印-p\" class=\"headerlink\" title=\"打印 p\"></a>打印 p</h2><p>将模式空间写到标准输出。注意：使用<code>sed &#39;p&#39; filename</code>会将文件内容每行打印两次，配合<code>-n</code>（或<code>--quiet</code>或<code>--silent</code>） 则可只打印一次（仅显示处理后的结果）。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed  --quiet '2,10p' file  #打印第2到10行</span><br><span class=\"line\">sed --quiet ''</span><br></pre></td></tr></table></figure>\n<h2 id=\"替换-s\"><a href=\"#替换-s\" class=\"headerlink\" title=\"替换 s\"></a>替换 s</h2><p>命令格式： <code>s/原内容/新内容/</code></p>\n<ul>\n<li>g全局替换：<code>s/原内容/新内容/g</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip addr | grep -o -E '1[^2][0-9?](\\.[0-9]&#123;1,3&#125;)&#123;3&#125;\\/' -o | sed 's/\\///'  #本机ip</span><br></pre></td></tr></table></figure>\n<h2 id=\"行编辑\"><a href=\"#行编辑\" class=\"headerlink\" title=\"行编辑\"></a>行编辑</h2><ul>\n<li>新增行<ul>\n<li><code>a</code>  在匹配项的<strong>下一行</strong>新增内容</li>\n<li><code>i</code>   在匹配项的<strong>上一行</strong>新增内容</li>\n</ul>\n</li>\n<li>替换行  <code>c</code></li>\n<li>删除行  <code>d</code></li>\n<li>多行<ul>\n<li>N  将数据流中的下一行加进来创建一个多行组来处理</li>\n<li>D  删除多行组中的一行</li>\n<li>P  打印多行组中的一行</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed  -i -e '1a hello' -e '2i world' filename</span><br><span class=\"line\">sed -i -e '1d' -e '2c new-world' filename</span><br></pre></td></tr></table></figure>\n<h2 id=\"模式空间\"><a href=\"#模式空间\" class=\"headerlink\" title=\"模式空间\"></a>模式空间</h2><p>  把当前处理的行存储在临时缓冲区中——模式空间。</p>\n<ul>\n<li><code>N</code>  将下一行内容纳入当前缓冲区</li>\n</ul>\n<ul>\n<li><code>h</code>  将模式空间复制到保持空间</li>\n<li><code>H</code>  将模式空间附加到保持空间</li>\n<li><code>g</code>  将保持空间复制到模式空间</li>\n<li><code>G</code>  将保持空间附加到模式空间</li>\n<li><code>x</code>  交换模式空间和保持空间的内容</li>\n</ul>\n","categories":[{"name":"命令","path":"api/categories/命令.json"}],"tags":[]}