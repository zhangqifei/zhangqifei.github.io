{"title":"nginx日志分析","slug":"shell脚本/nginx日志分析","date":"2019-06-28T06:39:22.719Z","updated":"2019-06-28T07:26:56.619Z","comments":true,"path":"api/articles/shell脚本/nginx日志分析.json","excerpt":null,"covers":null,"content":"<h1 id=\"统计PV-UV数\"><a href=\"#统计PV-UV数\" class=\"headerlink\" title=\"统计PV,UV数\"></a>统计PV,UV数</h1><h2 id=\"统计所有的PV数\"><a href=\"#统计所有的PV数\" class=\"headerlink\" title=\"统计所有的PV数\"></a>统计所有的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计当天的PV数\"><a href=\"#统计当天的PV数\" class=\"headerlink\" title=\"统计当天的PV数\"></a>统计当天的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | sed -n /`date &quot;+%d\\/%b\\/%Y&quot;`/p | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计指定某一天的PV数\"><a href=\"#统计指定某一天的PV数\" class=\"headerlink\" title=\"统计指定某一天的PV数\"></a>统计指定某一天的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | sed -n &apos;/20\\/Aug\\/2019/p&apos; | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"根据访问IP统计UV\"><a href=\"#根据访问IP统计UV\" class=\"headerlink\" title=\"根据访问IP统计UV\"></a>根据访问IP统计UV</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log|sort | uniq -c |wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计指定某一天访问IP统计UV\"><a href=\"#统计指定某一天访问IP统计UV\" class=\"headerlink\" title=\"统计指定某一天访问IP统计UV\"></a>统计指定某一天访问IP统计UV</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | grep &quot;07/Apr/2019:0[4-5]&quot; | awk &apos;&#123;print $1&#125;&apos; access.log|sort | uniq -c |wc -l</span><br></pre></td></tr></table></figure>\n<h1 id=\"IP相关统计\"><a href=\"#IP相关统计\" class=\"headerlink\" title=\"IP相关统计\"></a>IP相关统计</h1><h2 id=\"统计IP访问量（独立ip访问数量）\"><a href=\"#统计IP访问量（独立ip访问数量）\" class=\"headerlink\" title=\"统计IP访问量（独立ip访问数量）\"></a>统计IP访问量（独立ip访问数量）</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n | uniq | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看某一时间段的IP访问量-4-5点\"><a href=\"#查看某一时间段的IP访问量-4-5点\" class=\"headerlink\" title=\"查看某一时间段的IP访问量(4-5点)\"></a>查看某一时间段的IP访问量(4-5点)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &quot;07/Apr/2019:0[4-5]&quot; access.log | awk &apos;&#123;print $1&#125;&apos; | sort | uniq -c| sort -nr | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问最频繁的前100个IP\"><a href=\"#查看访问最频繁的前100个IP\" class=\"headerlink\" title=\"查看访问最频繁的前100个IP\"></a>查看访问最频繁的前100个IP</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问100次以上的IP\"><a href=\"#查看访问100次以上的IP\" class=\"headerlink\" title=\"查看访问100次以上的IP\"></a>查看访问100次以上的IP</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n |uniq -c |awk &apos;&#123;if($1 &gt;100) print $0&#125;&apos;|sort -rn</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询某个IP的详细访问情况-按访问频率排序\"><a href=\"#查询某个IP的详细访问情况-按访问频率排序\" class=\"headerlink\" title=\"查询某个IP的详细访问情况,按访问频率排序\"></a>查询某个IP的详细访问情况,按访问频率排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;127.0.01&apos; access.log |awk &apos;&#123;print $7&#125;&apos;|sort |uniq -c |sort -rn |head -n 100</span><br></pre></td></tr></table></figure>\n<h1 id=\"页面访问统计\"><a href=\"#页面访问统计\" class=\"headerlink\" title=\"页面访问统计\"></a>页面访问统计</h1><h2 id=\"查看访问最频的页面-TOP100\"><a href=\"#查看访问最频的页面-TOP100\" class=\"headerlink\" title=\"查看访问最频的页面(TOP100)\"></a>查看访问最频的页面(TOP100)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $7&#125;&apos; access.log | sort |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问最频的页面-排除php页面】-TOP100\"><a href=\"#查看访问最频的页面-排除php页面】-TOP100\" class=\"headerlink\" title=\"查看访问最频的页面([排除php页面】(TOP100)\"></a>查看访问最频的页面([排除php页面】(TOP100)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -v &quot;.php&quot;  access.log | awk &apos;&#123;print $7&#125;&apos; | sort |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询访问最频繁的URL\"><a href=\"#查询访问最频繁的URL\" class=\"headerlink\" title=\"查询访问最频繁的URL\"></a>查询访问最频繁的URL</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $7&#125;&apos; access.log|sort | uniq -c |sort -n -k 1 -r|more</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看页面访问次数超过100次的页面\"><a href=\"#查看页面访问次数超过100次的页面\" class=\"headerlink\" title=\"查看页面访问次数超过100次的页面\"></a>查看页面访问次数超过100次的页面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | cut -d &apos; &apos; -f 7 | sort |uniq -c | awk &apos;&#123;if ($1 &gt; 100) print $0&#125;&apos; | less</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看最近1000条记录，访问量最高的页面\"><a href=\"#查看最近1000条记录，访问量最高的页面\" class=\"headerlink\" title=\"查看最近1000条记录，访问量最高的页面\"></a>查看最近1000条记录，访问量最高的页面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -1000 access.log |awk &apos;&#123;print $7&#125;&apos;|sort|uniq -c|sort -nr|less</span><br></pre></td></tr></table></figure>\n<h1 id=\"每秒每分钟每小时请求量统计\"><a href=\"#每秒每分钟每小时请求量统计\" class=\"headerlink\" title=\"每秒每分钟每小时请求量统计\"></a>每秒每分钟每小时请求量统计</h1><h2 id=\"统计每秒的请求数-top100的时间点-精确到秒\"><a href=\"#统计每秒的请求数-top100的时间点-精确到秒\" class=\"headerlink\" title=\"统计每秒的请求数,top100的时间点(精确到秒)\"></a>统计每秒的请求数,top100的时间点(精确到秒)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-21|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计每分钟的请求数-top100的时间点-精确到分钟\"><a href=\"#统计每分钟的请求数-top100的时间点-精确到分钟\" class=\"headerlink\" title=\"统计每分钟的请求数,top100的时间点(精确到分钟)\"></a>统计每分钟的请求数,top100的时间点(精确到分钟)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-18|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"每小时的请求数-top100的时间点-精确到小时\"><a href=\"#每小时的请求数-top100的时间点-精确到小时\" class=\"headerlink\" title=\"每小时的请求数,top100的时间点(精确到小时)\"></a>每小时的请求数,top100的时间点(精确到小时)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-15|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h1 id=\"性能分析\"><a href=\"#性能分析\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h1><blockquote>\n<p>*在nginx log中最后一个字段加入$request_time</p>\n</blockquote>\n<h2 id=\"列出传输时间超过-3-秒的页面，显示前20条\"><a href=\"#列出传输时间超过-3-秒的页面，显示前20条\" class=\"headerlink\" title=\"列出传输时间超过 3 秒的页面，显示前20条\"></a>列出传输时间超过 3 秒的页面，显示前20条</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log|awk &apos;($NF &gt; 3)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -20</span><br></pre></td></tr></table></figure>\n<h2 id=\"列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\"><a href=\"#列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\" class=\"headerlink\" title=\"列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\"></a>列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log|awk &apos;($NF &gt; 1 &amp;&amp; $7~/\\.php/)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -100</span><br></pre></td></tr></table></figure>\n<h1 id=\"蜘蛛抓取统计\"><a href=\"#蜘蛛抓取统计\" class=\"headerlink\" title=\"蜘蛛抓取统计\"></a>蜘蛛抓取统计</h1><h2 id=\"统计蜘蛛抓取次数\"><a href=\"#统计蜘蛛抓取次数\" class=\"headerlink\" title=\"统计蜘蛛抓取次数\"></a>统计蜘蛛抓取次数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;Baiduspider&apos; access.log |wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计蜘蛛抓取404的次数\"><a href=\"#统计蜘蛛抓取404的次数\" class=\"headerlink\" title=\"统计蜘蛛抓取404的次数\"></a>统计蜘蛛抓取404的次数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;Baiduspider&apos; access.log |grep &apos;404&apos; | wc -l</span><br></pre></td></tr></table></figure>\n<h1 id=\"TCP连接统计\"><a href=\"#TCP连接统计\" class=\"headerlink\" title=\"TCP连接统计\"></a>TCP连接统计</h1><h2 id=\"查看当前TCP连接数\"><a href=\"#查看当前TCP连接数\" class=\"headerlink\" title=\"查看当前TCP连接数\"></a>查看当前TCP连接数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -tan | grep &quot;ESTABLISHED&quot; | grep &quot;:80&quot; | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"用tcpdump嗅探80端口的访问看看谁最高\"><a href=\"#用tcpdump嗅探80端口的访问看看谁最高\" class=\"headerlink\" title=\"用tcpdump嗅探80端口的访问看看谁最高\"></a>用tcpdump嗅探80端口的访问看看谁最高</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F&quot;.&quot; &apos;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4&#125;&apos; | sort | uniq -c | sort -nr</span><br></pre></td></tr></table></figure>","more":"<h1 id=\"统计PV-UV数\"><a href=\"#统计PV-UV数\" class=\"headerlink\" title=\"统计PV,UV数\"></a>统计PV,UV数</h1><h2 id=\"统计所有的PV数\"><a href=\"#统计所有的PV数\" class=\"headerlink\" title=\"统计所有的PV数\"></a>统计所有的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计当天的PV数\"><a href=\"#统计当天的PV数\" class=\"headerlink\" title=\"统计当天的PV数\"></a>统计当天的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | sed -n /`date &quot;+%d\\/%b\\/%Y&quot;`/p | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计指定某一天的PV数\"><a href=\"#统计指定某一天的PV数\" class=\"headerlink\" title=\"统计指定某一天的PV数\"></a>统计指定某一天的PV数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | sed -n &apos;/20\\/Aug\\/2019/p&apos; | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"根据访问IP统计UV\"><a href=\"#根据访问IP统计UV\" class=\"headerlink\" title=\"根据访问IP统计UV\"></a>根据访问IP统计UV</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log|sort | uniq -c |wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计指定某一天访问IP统计UV\"><a href=\"#统计指定某一天访问IP统计UV\" class=\"headerlink\" title=\"统计指定某一天访问IP统计UV\"></a>统计指定某一天访问IP统计UV</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | grep &quot;07/Apr/2019:0[4-5]&quot; | awk &apos;&#123;print $1&#125;&apos; access.log|sort | uniq -c |wc -l</span><br></pre></td></tr></table></figure>\n<h1 id=\"IP相关统计\"><a href=\"#IP相关统计\" class=\"headerlink\" title=\"IP相关统计\"></a>IP相关统计</h1><h2 id=\"统计IP访问量（独立ip访问数量）\"><a href=\"#统计IP访问量（独立ip访问数量）\" class=\"headerlink\" title=\"统计IP访问量（独立ip访问数量）\"></a>统计IP访问量（独立ip访问数量）</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n | uniq | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看某一时间段的IP访问量-4-5点\"><a href=\"#查看某一时间段的IP访问量-4-5点\" class=\"headerlink\" title=\"查看某一时间段的IP访问量(4-5点)\"></a>查看某一时间段的IP访问量(4-5点)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &quot;07/Apr/2019:0[4-5]&quot; access.log | awk &apos;&#123;print $1&#125;&apos; | sort | uniq -c| sort -nr | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问最频繁的前100个IP\"><a href=\"#查看访问最频繁的前100个IP\" class=\"headerlink\" title=\"查看访问最频繁的前100个IP\"></a>查看访问最频繁的前100个IP</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问100次以上的IP\"><a href=\"#查看访问100次以上的IP\" class=\"headerlink\" title=\"查看访问100次以上的IP\"></a>查看访问100次以上的IP</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $1&#125;&apos; access.log | sort -n |uniq -c |awk &apos;&#123;if($1 &gt;100) print $0&#125;&apos;|sort -rn</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询某个IP的详细访问情况-按访问频率排序\"><a href=\"#查询某个IP的详细访问情况-按访问频率排序\" class=\"headerlink\" title=\"查询某个IP的详细访问情况,按访问频率排序\"></a>查询某个IP的详细访问情况,按访问频率排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;127.0.01&apos; access.log |awk &apos;&#123;print $7&#125;&apos;|sort |uniq -c |sort -rn |head -n 100</span><br></pre></td></tr></table></figure>\n<h1 id=\"页面访问统计\"><a href=\"#页面访问统计\" class=\"headerlink\" title=\"页面访问统计\"></a>页面访问统计</h1><h2 id=\"查看访问最频的页面-TOP100\"><a href=\"#查看访问最频的页面-TOP100\" class=\"headerlink\" title=\"查看访问最频的页面(TOP100)\"></a>查看访问最频的页面(TOP100)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $7&#125;&apos; access.log | sort |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看访问最频的页面-排除php页面】-TOP100\"><a href=\"#查看访问最频的页面-排除php页面】-TOP100\" class=\"headerlink\" title=\"查看访问最频的页面([排除php页面】(TOP100)\"></a>查看访问最频的页面([排除php页面】(TOP100)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -v &quot;.php&quot;  access.log | awk &apos;&#123;print $7&#125;&apos; | sort |uniq -c | sort -rn | head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询访问最频繁的URL\"><a href=\"#查询访问最频繁的URL\" class=\"headerlink\" title=\"查询访问最频繁的URL\"></a>查询访问最频繁的URL</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $7&#125;&apos; access.log|sort | uniq -c |sort -n -k 1 -r|more</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看页面访问次数超过100次的页面\"><a href=\"#查看页面访问次数超过100次的页面\" class=\"headerlink\" title=\"查看页面访问次数超过100次的页面\"></a>查看页面访问次数超过100次的页面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log | cut -d &apos; &apos; -f 7 | sort |uniq -c | awk &apos;&#123;if ($1 &gt; 100) print $0&#125;&apos; | less</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看最近1000条记录，访问量最高的页面\"><a href=\"#查看最近1000条记录，访问量最高的页面\" class=\"headerlink\" title=\"查看最近1000条记录，访问量最高的页面\"></a>查看最近1000条记录，访问量最高的页面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -1000 access.log |awk &apos;&#123;print $7&#125;&apos;|sort|uniq -c|sort -nr|less</span><br></pre></td></tr></table></figure>\n<h1 id=\"每秒每分钟每小时请求量统计\"><a href=\"#每秒每分钟每小时请求量统计\" class=\"headerlink\" title=\"每秒每分钟每小时请求量统计\"></a>每秒每分钟每小时请求量统计</h1><h2 id=\"统计每秒的请求数-top100的时间点-精确到秒\"><a href=\"#统计每秒的请求数-top100的时间点-精确到秒\" class=\"headerlink\" title=\"统计每秒的请求数,top100的时间点(精确到秒)\"></a>统计每秒的请求数,top100的时间点(精确到秒)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-21|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计每分钟的请求数-top100的时间点-精确到分钟\"><a href=\"#统计每分钟的请求数-top100的时间点-精确到分钟\" class=\"headerlink\" title=\"统计每分钟的请求数,top100的时间点(精确到分钟)\"></a>统计每分钟的请求数,top100的时间点(精确到分钟)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-18|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h2 id=\"每小时的请求数-top100的时间点-精确到小时\"><a href=\"#每小时的请求数-top100的时间点-精确到小时\" class=\"headerlink\" title=\"每小时的请求数,top100的时间点(精确到小时)\"></a>每小时的请求数,top100的时间点(精确到小时)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &apos;&#123;print $4&#125;&apos; access.log |cut -c 14-15|sort|uniq -c|sort -nr|head -n 100</span><br></pre></td></tr></table></figure>\n<h1 id=\"性能分析\"><a href=\"#性能分析\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h1><blockquote>\n<p>*在nginx log中最后一个字段加入$request_time</p>\n</blockquote>\n<h2 id=\"列出传输时间超过-3-秒的页面，显示前20条\"><a href=\"#列出传输时间超过-3-秒的页面，显示前20条\" class=\"headerlink\" title=\"列出传输时间超过 3 秒的页面，显示前20条\"></a>列出传输时间超过 3 秒的页面，显示前20条</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log|awk &apos;($NF &gt; 3)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -20</span><br></pre></td></tr></table></figure>\n<h2 id=\"列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\"><a href=\"#列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\" class=\"headerlink\" title=\"列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条\"></a>列出php页面请求时间超过3秒的页面，并统计其出现的次数，显示前100条</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat access.log|awk &apos;($NF &gt; 1 &amp;&amp; $7~/\\.php/)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -100</span><br></pre></td></tr></table></figure>\n<h1 id=\"蜘蛛抓取统计\"><a href=\"#蜘蛛抓取统计\" class=\"headerlink\" title=\"蜘蛛抓取统计\"></a>蜘蛛抓取统计</h1><h2 id=\"统计蜘蛛抓取次数\"><a href=\"#统计蜘蛛抓取次数\" class=\"headerlink\" title=\"统计蜘蛛抓取次数\"></a>统计蜘蛛抓取次数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;Baiduspider&apos; access.log |wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"统计蜘蛛抓取404的次数\"><a href=\"#统计蜘蛛抓取404的次数\" class=\"headerlink\" title=\"统计蜘蛛抓取404的次数\"></a>统计蜘蛛抓取404的次数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &apos;Baiduspider&apos; access.log |grep &apos;404&apos; | wc -l</span><br></pre></td></tr></table></figure>\n<h1 id=\"TCP连接统计\"><a href=\"#TCP连接统计\" class=\"headerlink\" title=\"TCP连接统计\"></a>TCP连接统计</h1><h2 id=\"查看当前TCP连接数\"><a href=\"#查看当前TCP连接数\" class=\"headerlink\" title=\"查看当前TCP连接数\"></a>查看当前TCP连接数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -tan | grep &quot;ESTABLISHED&quot; | grep &quot;:80&quot; | wc -l</span><br></pre></td></tr></table></figure>\n<h2 id=\"用tcpdump嗅探80端口的访问看看谁最高\"><a href=\"#用tcpdump嗅探80端口的访问看看谁最高\" class=\"headerlink\" title=\"用tcpdump嗅探80端口的访问看看谁最高\"></a>用tcpdump嗅探80端口的访问看看谁最高</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F&quot;.&quot; &apos;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4&#125;&apos; | sort | uniq -c | sort -nr</span><br></pre></td></tr></table></figure>","categories":[{"name":"shell脚本","path":"api/categories/shell脚本.json"}],"tags":[{"name":"shell脚本","path":"api/tags/shell脚本.json"}]}