{"title":"ab命令压力测试","slug":"linux/ab命令压力测试","date":"2016-06-06T01:41:22.000Z","updated":"2018-04-22T09:29:32.756Z","comments":true,"path":"api/articles/linux/ab命令压力测试.json","excerpt":null,"covers":null,"content":"<p>网站性能压力测试是服务器网站性能调优过程中必不可缺少的一环。只有让服务器处在高压情况下，才能真正体现出软件、硬件等各种设置不当所暴露出的问题。</p>\n<p>性能测试工具目前最常见的有以下几种：ab、http_load、webbench、siege。今天我们专门来介绍ab。</p>\n<p>ab是apache自带的压力测试工具。ab非常实用，它不仅可以对apache服务器进行网站访问压力测试，也可以对或其它类型的服务器进行压力测试。比如nginx、tomcat、IIS等。</p>\n<p><a href=\"http://httpd.apache.org/docs/2.2/programs/ab.html\" target=\"_blank\" rel=\"noopener\">官方参数文档</a></p>\n<h4 id=\"一、ab的原理\"><a href=\"#一、ab的原理\" class=\"headerlink\" title=\"一、ab的原理\"></a>一、ab的原理</h4><p>ab是apachebench命令的缩写。</p>\n<p>ab的原理：ab命令会创建多个并发访问线程，模拟多个访问者同时对某一URL地址进行访问。它的测试目标是基于URL的，因此，它既可以用来测试apache的负载压力，也可以测试nginx、lighthttp、tomcat、IIS等其它Web服务器的压力。</p>\n<p>ab命令对发出负载的计算机要求很低，它既不会占用很高CPU，也不会占用很多内存。但却会给目标服务器造成巨大的负载，其原理类似CC攻击。自己测试使用也需要注意，否则一次上太多的负载。可能造成目标服务器资源耗完，严重时甚至导致死机。</p>\n<h4 id=\"二、ab的安装\"><a href=\"#二、ab的安装\" class=\"headerlink\" title=\"二、ab的安装\"></a>二、ab的安装</h4><p>ab的安装非常简单，如果是源码安装apache的话，那就更简单了。apache安装完毕后ab命令存放在apache安装目录的bin目录下。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/apache2/bin</span><br></pre></td></tr></table></figure></p>\n<p>如果apache 是通过yum的RPM包方式安装的话，ab命令默认存放在/usr/bin目录下。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which ab</span><br></pre></td></tr></table></figure></p>\n<p>注意：如果不想安装apache但是又想使用ab命令的话，我们可以直接安装apache的工具包httpd-tools。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install httpd-tools</span><br></pre></td></tr></table></figure></p>\n<p>查看ab是否安装成功，可以切换到上述目录下，使用ab –V命令进行检测。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -V</span><br></pre></td></tr></table></figure></p>\n<p>如果ab安装成功，通过ab –V命令则会显示ab的相迎版本，如上图示。</p>\n<p>注意以上是在linux平台下进行安装的，如果是windows平台下，我们也可以下载对应的apache版本进行安装。</p>\n<p>目前apache最新版2.4.10，apache官网已经没有windows下载的版本。</p>\n<h4 id=\"三、ab参数说明\"><a href=\"#三、ab参数说明\" class=\"headerlink\" title=\"三、ab参数说明\"></a>三、ab参数说明</h4><p>有关ab命令的使用，我们可以通过帮助命令进行查看。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab --help</span><br></pre></td></tr></table></figure></p>\n<p>下面我们对这些参数，进行相关说明。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-n  在测试会话中所执行的请求个数。默认时，仅执行一个请求。</span><br><span class=\"line\"></span><br><span class=\"line\">-c  一次产生的请求个数。默认是一次一个。</span><br><span class=\"line\"></span><br><span class=\"line\">-t  测试所进行的最大秒数。其内部隐含值是-n 50000，它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。</span><br><span class=\"line\"></span><br><span class=\"line\">-p  包含了需要POST的数据的文件。</span><br><span class=\"line\"></span><br><span class=\"line\">-P  对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。</span><br><span class=\"line\"></span><br><span class=\"line\">-T  POST数据所使用的Content-type头信息。</span><br><span class=\"line\"></span><br><span class=\"line\">-v  设置显示信息的详细程度-4或更大值会显示头信息，3或更大值可以显示响应代码(404,200等),2或更大值可以显示警告和其他信息。</span><br><span class=\"line\"></span><br><span class=\"line\">-V  显示版本号并退出。</span><br><span class=\"line\"></span><br><span class=\"line\">-w  以HTML表的格式输出结果。默认时，它是白色背景的两列宽度的一张表。</span><br><span class=\"line\"></span><br><span class=\"line\">-i  执行HEAD请求，而不是GET。</span><br><span class=\"line\"></span><br><span class=\"line\">-x  设置&lt;table&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-X  对请求使用代理服务器。</span><br><span class=\"line\"></span><br><span class=\"line\">-y  设置&lt;tr&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-z  设置&lt;td&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-C  对请求附加一个Cookie:行。其典型形式是name=value的一个参数对，此参数可以重复。</span><br><span class=\"line\"></span><br><span class=\"line\">-H  对请求附加额外的头信息。此参数的典型形式是一个有效的头信息行，其中包含了以冒号分隔的字段和值的对(如,&quot;Accept-Encoding:zip/zop;8bit&quot;)。</span><br><span class=\"line\"></span><br><span class=\"line\">-A  对服务器提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即,是否发送了401认证需求代码)，此字符串都会被发送。</span><br><span class=\"line\"></span><br><span class=\"line\">-h  显示使用方法。</span><br><span class=\"line\"></span><br><span class=\"line\">-d  不显示&quot;percentage served within XX [ms] table&quot;的消息(为以前的版本提供支持)。</span><br><span class=\"line\"></span><br><span class=\"line\">-e  产生一个以逗号分隔的(CSV)文件，其中包含了处理每个相应百分比的请求所需要(从1%到100%)的相应百分比的(以微妙为单位)时间。由于这种格式已经“二进制化”，所以比&apos;gnuplot&apos;格式更有用。</span><br><span class=\"line\"></span><br><span class=\"line\">-g  把所有测试结果写入一个&apos;gnuplot&apos;或者TSV(以Tab分隔的)文件。此文件可以方便地导入到Gnuplot,IDL,Mathematica,Igor甚至Excel中。其中的第一行为标题。</span><br><span class=\"line\"></span><br><span class=\"line\">-i  执行HEAD请求，而不是GET。</span><br><span class=\"line\"></span><br><span class=\"line\">-k  启用HTTP KeepAlive功能，即在一个HTTP会话中执行多个请求。默认时，不启用KeepAlive功能。</span><br><span class=\"line\"></span><br><span class=\"line\">-q  如果处理的请求数大于150，ab每处理大约10%或者100个请求时，会在stderr输出一个进度计数。此-q标记可以抑制这些信息。</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"四、ab性能指标\"><a href=\"#四、ab性能指标\" class=\"headerlink\" title=\"四、ab性能指标\"></a>四、ab性能指标</h4><p>在进行性能测试过程中有几个指标比较重要：</p>\n<p>1、吞吐率（Requests per second）</p>\n<p>服务器并发处理能力的量化描述，单位是reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。</p>\n<p>记住：吞吐率是基于并发用户数的。这句话代表了两个含义：</p>\n<ul>\n<li>a、吞吐率和并发用户数相关</li>\n<li>b、不同的并发用户数下，吞吐率一般是不同的</li>\n</ul>\n<p>计算公式：总请求数/处理完成这些请求数所花费的时间，即<code>Request per second=Complete requests/Time taken for tests</code>必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。</p>\n<p>2、并发连接数（The number of concurrent connections）</p>\n<p>并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话。</p>\n<p>3、并发用户数（Concurrency Level）</p>\n<p>要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在HTTP/1.1下，IE7支持两个并发连接，IE8支持6个并发连接，FireFox3支持4个并发连接，所以相应的，我们的并发用户数就得除以这个基数。</p>\n<p>4、用户平均请求等待时间（Time per request）</p>\n<p>计算公式：处理完成所有请求数所花费的时间/（总请求数/并发用户数），即：<code>Time per request=Time taken for tests/（Complete requests/Concurrency Level）</code></p>\n<p>5、服务器平均请求等待时间（Time per request:across all concurrent requests）</p>\n<p>计算公式：处理完成所有请求数所花费的时间/总请求数，即：<code>Time taken for/testsComplete requests</code>可以看到，它是吞吐率的倒数。</p>\n<p>同时，它也等于用户平均请求等待时间/并发用户数，即<code>Time per request/Concurrency Level</code></p>\n<h4 id=\"五、ab实际使用\"><a href=\"#五、ab实际使用\" class=\"headerlink\" title=\"五、ab实际使用\"></a>五、ab实际使用</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]#ab -c 10 -n 100 http://a.ilanni.com/index.php</span><br><span class=\"line\">\t-c    10表示并发用户数为10</span><br><span class=\"line\">\t-n    100表示请求总数为100</span><br><span class=\"line\">\thttp://a.ilanni.com/index.php表示请求的目标URL</span><br><span class=\"line\">\t这行表示同时处理100个请求并运行10次index.php文件。</span><br><span class=\"line\"></span><br><span class=\"line\">[root@centos7 ~]#ab -c 10 -n 100 http://a.ilanni.com/index.php</span><br><span class=\"line\">Benchmarking 47.93.96.25 (be patient).....done</span><br><span class=\"line\"></span><br><span class=\"line\">Server Software:        Apache/2.4.29  ##apache版本 </span><br><span class=\"line\">Server Hostname:        ip地址   ##请求的机子 </span><br><span class=\"line\">Server Port:            80  ##请求端口</span><br><span class=\"line\"></span><br><span class=\"line\">Document Path:          index.php</span><br><span class=\"line\">Document Length:        18483 bytes  ##页面长度</span><br><span class=\"line\"></span><br><span class=\"line\">Concurrency Level:      10  ##并发数</span><br><span class=\"line\">Time taken for tests:   25.343 seconds  ##共使用了多少时间</span><br><span class=\"line\">Complete requests:      100  ##请求数</span><br><span class=\"line\">Failed requests:        11  ##失败请求</span><br><span class=\"line\">   (Connect: 0, Receive: 0, Length: 11, Exceptions: 0)</span><br><span class=\"line\">Total transferred:      1873511 bytes  ##总共传输字节数，包含http的头信息等</span><br><span class=\"line\">HTML transferred:       1848311 bytes  ##html字节数，实际的页面传递字节数</span><br><span class=\"line\">Requests per second:    3.95 [#/sec] (mean)  ##每秒多少请求，这个是非常重要的参数数值，服务器的吞吐量</span><br><span class=\"line\">Time per request:       2534.265 [ms] (mean)  ##用户平均请求等待时间</span><br><span class=\"line\">Time per request:       253.426 [ms] (mean, across all concurrent requests)  ##服务器平均处理时间，</span><br><span class=\"line\">Transfer rate:          72.19 [Kbytes/sec] received  ##每秒获取的数据长度</span><br><span class=\"line\"></span><br><span class=\"line\">Connection Times (ms)</span><br><span class=\"line\">              min  mean[+/-sd] median   max</span><br><span class=\"line\">Connect:        0    8   3.9     10      13</span><br><span class=\"line\">Processing:  1222 2453 322.6   2520    3436</span><br><span class=\"line\">Waiting:     1175 2385 320.4   2452    3372</span><br><span class=\"line\">Total:       1222 2461 322.5   2528    3444</span><br><span class=\"line\"></span><br><span class=\"line\">Percentage of the requests served within a certain time (ms)</span><br><span class=\"line\">  50%   2528  ## 50%的请求在25ms内返回 </span><br><span class=\"line\">  66%   2534  ## 60%的请求在26ms内返回 </span><br><span class=\"line\">  75%   2538</span><br><span class=\"line\">  80%   2539</span><br><span class=\"line\">  90%   2545</span><br><span class=\"line\">  95%   2556</span><br><span class=\"line\">  98%   3395</span><br><span class=\"line\">  99%   3444</span><br><span class=\"line\"> 100%   3444 (longest request)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>apache的ab工具也算是一种ddos攻击工具<br>nginx吞吐率就是要比apache高。<br>根据前面我们提到的性能指标Requests per second吞吐率越高，服务器性能越好。</p>\n</blockquote>\n","more":"<p>网站性能压力测试是服务器网站性能调优过程中必不可缺少的一环。只有让服务器处在高压情况下，才能真正体现出软件、硬件等各种设置不当所暴露出的问题。</p>\n<p>性能测试工具目前最常见的有以下几种：ab、http_load、webbench、siege。今天我们专门来介绍ab。</p>\n<p>ab是apache自带的压力测试工具。ab非常实用，它不仅可以对apache服务器进行网站访问压力测试，也可以对或其它类型的服务器进行压力测试。比如nginx、tomcat、IIS等。</p>\n<p><a href=\"http://httpd.apache.org/docs/2.2/programs/ab.html\" target=\"_blank\" rel=\"noopener\">官方参数文档</a></p>\n<h4 id=\"一、ab的原理\"><a href=\"#一、ab的原理\" class=\"headerlink\" title=\"一、ab的原理\"></a>一、ab的原理</h4><p>ab是apachebench命令的缩写。</p>\n<p>ab的原理：ab命令会创建多个并发访问线程，模拟多个访问者同时对某一URL地址进行访问。它的测试目标是基于URL的，因此，它既可以用来测试apache的负载压力，也可以测试nginx、lighthttp、tomcat、IIS等其它Web服务器的压力。</p>\n<p>ab命令对发出负载的计算机要求很低，它既不会占用很高CPU，也不会占用很多内存。但却会给目标服务器造成巨大的负载，其原理类似CC攻击。自己测试使用也需要注意，否则一次上太多的负载。可能造成目标服务器资源耗完，严重时甚至导致死机。</p>\n<h4 id=\"二、ab的安装\"><a href=\"#二、ab的安装\" class=\"headerlink\" title=\"二、ab的安装\"></a>二、ab的安装</h4><p>ab的安装非常简单，如果是源码安装apache的话，那就更简单了。apache安装完毕后ab命令存放在apache安装目录的bin目录下。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/apache2/bin</span><br></pre></td></tr></table></figure></p>\n<p>如果apache 是通过yum的RPM包方式安装的话，ab命令默认存放在/usr/bin目录下。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which ab</span><br></pre></td></tr></table></figure></p>\n<p>注意：如果不想安装apache但是又想使用ab命令的话，我们可以直接安装apache的工具包httpd-tools。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install httpd-tools</span><br></pre></td></tr></table></figure></p>\n<p>查看ab是否安装成功，可以切换到上述目录下，使用ab –V命令进行检测。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -V</span><br></pre></td></tr></table></figure></p>\n<p>如果ab安装成功，通过ab –V命令则会显示ab的相迎版本，如上图示。</p>\n<p>注意以上是在linux平台下进行安装的，如果是windows平台下，我们也可以下载对应的apache版本进行安装。</p>\n<p>目前apache最新版2.4.10，apache官网已经没有windows下载的版本。</p>\n<h4 id=\"三、ab参数说明\"><a href=\"#三、ab参数说明\" class=\"headerlink\" title=\"三、ab参数说明\"></a>三、ab参数说明</h4><p>有关ab命令的使用，我们可以通过帮助命令进行查看。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab --help</span><br></pre></td></tr></table></figure></p>\n<p>下面我们对这些参数，进行相关说明。如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-n  在测试会话中所执行的请求个数。默认时，仅执行一个请求。</span><br><span class=\"line\"></span><br><span class=\"line\">-c  一次产生的请求个数。默认是一次一个。</span><br><span class=\"line\"></span><br><span class=\"line\">-t  测试所进行的最大秒数。其内部隐含值是-n 50000，它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。</span><br><span class=\"line\"></span><br><span class=\"line\">-p  包含了需要POST的数据的文件。</span><br><span class=\"line\"></span><br><span class=\"line\">-P  对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。</span><br><span class=\"line\"></span><br><span class=\"line\">-T  POST数据所使用的Content-type头信息。</span><br><span class=\"line\"></span><br><span class=\"line\">-v  设置显示信息的详细程度-4或更大值会显示头信息，3或更大值可以显示响应代码(404,200等),2或更大值可以显示警告和其他信息。</span><br><span class=\"line\"></span><br><span class=\"line\">-V  显示版本号并退出。</span><br><span class=\"line\"></span><br><span class=\"line\">-w  以HTML表的格式输出结果。默认时，它是白色背景的两列宽度的一张表。</span><br><span class=\"line\"></span><br><span class=\"line\">-i  执行HEAD请求，而不是GET。</span><br><span class=\"line\"></span><br><span class=\"line\">-x  设置&lt;table&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-X  对请求使用代理服务器。</span><br><span class=\"line\"></span><br><span class=\"line\">-y  设置&lt;tr&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-z  设置&lt;td&gt;属性的字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">-C  对请求附加一个Cookie:行。其典型形式是name=value的一个参数对，此参数可以重复。</span><br><span class=\"line\"></span><br><span class=\"line\">-H  对请求附加额外的头信息。此参数的典型形式是一个有效的头信息行，其中包含了以冒号分隔的字段和值的对(如,&quot;Accept-Encoding:zip/zop;8bit&quot;)。</span><br><span class=\"line\"></span><br><span class=\"line\">-A  对服务器提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即,是否发送了401认证需求代码)，此字符串都会被发送。</span><br><span class=\"line\"></span><br><span class=\"line\">-h  显示使用方法。</span><br><span class=\"line\"></span><br><span class=\"line\">-d  不显示&quot;percentage served within XX [ms] table&quot;的消息(为以前的版本提供支持)。</span><br><span class=\"line\"></span><br><span class=\"line\">-e  产生一个以逗号分隔的(CSV)文件，其中包含了处理每个相应百分比的请求所需要(从1%到100%)的相应百分比的(以微妙为单位)时间。由于这种格式已经“二进制化”，所以比&apos;gnuplot&apos;格式更有用。</span><br><span class=\"line\"></span><br><span class=\"line\">-g  把所有测试结果写入一个&apos;gnuplot&apos;或者TSV(以Tab分隔的)文件。此文件可以方便地导入到Gnuplot,IDL,Mathematica,Igor甚至Excel中。其中的第一行为标题。</span><br><span class=\"line\"></span><br><span class=\"line\">-i  执行HEAD请求，而不是GET。</span><br><span class=\"line\"></span><br><span class=\"line\">-k  启用HTTP KeepAlive功能，即在一个HTTP会话中执行多个请求。默认时，不启用KeepAlive功能。</span><br><span class=\"line\"></span><br><span class=\"line\">-q  如果处理的请求数大于150，ab每处理大约10%或者100个请求时，会在stderr输出一个进度计数。此-q标记可以抑制这些信息。</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"四、ab性能指标\"><a href=\"#四、ab性能指标\" class=\"headerlink\" title=\"四、ab性能指标\"></a>四、ab性能指标</h4><p>在进行性能测试过程中有几个指标比较重要：</p>\n<p>1、吞吐率（Requests per second）</p>\n<p>服务器并发处理能力的量化描述，单位是reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。</p>\n<p>记住：吞吐率是基于并发用户数的。这句话代表了两个含义：</p>\n<ul>\n<li>a、吞吐率和并发用户数相关</li>\n<li>b、不同的并发用户数下，吞吐率一般是不同的</li>\n</ul>\n<p>计算公式：总请求数/处理完成这些请求数所花费的时间，即<code>Request per second=Complete requests/Time taken for tests</code>必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。</p>\n<p>2、并发连接数（The number of concurrent connections）</p>\n<p>并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话。</p>\n<p>3、并发用户数（Concurrency Level）</p>\n<p>要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在HTTP/1.1下，IE7支持两个并发连接，IE8支持6个并发连接，FireFox3支持4个并发连接，所以相应的，我们的并发用户数就得除以这个基数。</p>\n<p>4、用户平均请求等待时间（Time per request）</p>\n<p>计算公式：处理完成所有请求数所花费的时间/（总请求数/并发用户数），即：<code>Time per request=Time taken for tests/（Complete requests/Concurrency Level）</code></p>\n<p>5、服务器平均请求等待时间（Time per request:across all concurrent requests）</p>\n<p>计算公式：处理完成所有请求数所花费的时间/总请求数，即：<code>Time taken for/testsComplete requests</code>可以看到，它是吞吐率的倒数。</p>\n<p>同时，它也等于用户平均请求等待时间/并发用户数，即<code>Time per request/Concurrency Level</code></p>\n<h4 id=\"五、ab实际使用\"><a href=\"#五、ab实际使用\" class=\"headerlink\" title=\"五、ab实际使用\"></a>五、ab实际使用</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]#ab -c 10 -n 100 http://a.ilanni.com/index.php</span><br><span class=\"line\">\t-c    10表示并发用户数为10</span><br><span class=\"line\">\t-n    100表示请求总数为100</span><br><span class=\"line\">\thttp://a.ilanni.com/index.php表示请求的目标URL</span><br><span class=\"line\">\t这行表示同时处理100个请求并运行10次index.php文件。</span><br><span class=\"line\"></span><br><span class=\"line\">[root@centos7 ~]#ab -c 10 -n 100 http://a.ilanni.com/index.php</span><br><span class=\"line\">Benchmarking 47.93.96.25 (be patient).....done</span><br><span class=\"line\"></span><br><span class=\"line\">Server Software:        Apache/2.4.29  ##apache版本 </span><br><span class=\"line\">Server Hostname:        ip地址   ##请求的机子 </span><br><span class=\"line\">Server Port:            80  ##请求端口</span><br><span class=\"line\"></span><br><span class=\"line\">Document Path:          index.php</span><br><span class=\"line\">Document Length:        18483 bytes  ##页面长度</span><br><span class=\"line\"></span><br><span class=\"line\">Concurrency Level:      10  ##并发数</span><br><span class=\"line\">Time taken for tests:   25.343 seconds  ##共使用了多少时间</span><br><span class=\"line\">Complete requests:      100  ##请求数</span><br><span class=\"line\">Failed requests:        11  ##失败请求</span><br><span class=\"line\">   (Connect: 0, Receive: 0, Length: 11, Exceptions: 0)</span><br><span class=\"line\">Total transferred:      1873511 bytes  ##总共传输字节数，包含http的头信息等</span><br><span class=\"line\">HTML transferred:       1848311 bytes  ##html字节数，实际的页面传递字节数</span><br><span class=\"line\">Requests per second:    3.95 [#/sec] (mean)  ##每秒多少请求，这个是非常重要的参数数值，服务器的吞吐量</span><br><span class=\"line\">Time per request:       2534.265 [ms] (mean)  ##用户平均请求等待时间</span><br><span class=\"line\">Time per request:       253.426 [ms] (mean, across all concurrent requests)  ##服务器平均处理时间，</span><br><span class=\"line\">Transfer rate:          72.19 [Kbytes/sec] received  ##每秒获取的数据长度</span><br><span class=\"line\"></span><br><span class=\"line\">Connection Times (ms)</span><br><span class=\"line\">              min  mean[+/-sd] median   max</span><br><span class=\"line\">Connect:        0    8   3.9     10      13</span><br><span class=\"line\">Processing:  1222 2453 322.6   2520    3436</span><br><span class=\"line\">Waiting:     1175 2385 320.4   2452    3372</span><br><span class=\"line\">Total:       1222 2461 322.5   2528    3444</span><br><span class=\"line\"></span><br><span class=\"line\">Percentage of the requests served within a certain time (ms)</span><br><span class=\"line\">  50%   2528  ## 50%的请求在25ms内返回 </span><br><span class=\"line\">  66%   2534  ## 60%的请求在26ms内返回 </span><br><span class=\"line\">  75%   2538</span><br><span class=\"line\">  80%   2539</span><br><span class=\"line\">  90%   2545</span><br><span class=\"line\">  95%   2556</span><br><span class=\"line\">  98%   3395</span><br><span class=\"line\">  99%   3444</span><br><span class=\"line\"> 100%   3444 (longest request)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>apache的ab工具也算是一种ddos攻击工具<br>nginx吞吐率就是要比apache高。<br>根据前面我们提到的性能指标Requests per second吞吐率越高，服务器性能越好。</p>\n</blockquote>\n","categories":[{"name":"linux","path":"api/categories/linux.json"}],"tags":[{"name":"命令","path":"api/tags/命令.json"}]}